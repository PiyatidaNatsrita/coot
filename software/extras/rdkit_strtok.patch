--- ./Code/GraphMol/StructChecker/Pattern.cpp.orig	2018-08-07 20:18:42 +0200
+++ ./Code/GraphMol/StructChecker/Pattern.cpp	2018-08-07 20:49:32 +0200
@@ -18,6 +18,55 @@
 #endif
 #endif
 
+#ifdef WIN32
+#if !defined strtok_s
+/* 
+ * public domain strtok_r() by Charlie Gordon
+ *
+ *   from comp.lang.c  9/14/2007
+ *
+ *      http://groups.google.com/group/comp.lang.c/msg/2ab1ecbb86646684
+ *
+ *     (Declaration that it's public domain):
+ *      http://groups.google.com/group/comp.lang.c/msg/7c7b39328fefab9c
+ */
+
+char* strtok_r(
+    char *str, 
+    const char *delim, 
+    char **nextp)
+{
+    char *ret;
+
+    if (str == NULL)
+    {
+        str = *nextp;
+    }
+
+    str += strspn(str, delim);
+
+    if (*str == '\0')
+    {
+        return NULL;
+    }
+
+    ret = str;
+
+    str += strcspn(str, delim);
+
+    if (*str)
+    {
+        *str++ = '\0';
+    }
+
+    *nextp = str;
+
+    return ret;
+}
+#endif
+#endif
+
+
 namespace RDKit {
 namespace StructureCheck {
    
@@ -91,8 +140,10 @@
   // comma separated list of atom symbols:
   char *context;
 #ifdef WIN32
+#if defined strtok_s
 #define strtok_r strtok_s  // thread safe strtok()
 #endif
+#endif
   const char *atsym = symbol.c_str();
   char buf[512];
   char *tokp;
--- ./Code/GraphMol/StructChecker/Pattern.h.orig	2018-08-07 23:11:49 +0200
+++ ./Code/GraphMol/StructChecker/Pattern.h	2018-08-07 23:12:12 +0200
@@ -11,6 +11,26 @@
 #include "StructChecker.h"
 #include "Utilites.h"
 
+#ifdef WIN32
+#if !defined strtok_s
+/* 
+ * public domain strtok_r() by Charlie Gordon
+ *
+ *   from comp.lang.c  9/14/2007
+ *
+ *      http://groups.google.com/group/comp.lang.c/msg/2ab1ecbb86646684
+ *
+ *     (Declaration that it's public domain):
+ *      http://groups.google.com/group/comp.lang.c/msg/7c7b39328fefab9c
+ */
+
+char* strtok_r(
+    char *str, 
+    const char *delim, 
+    char **nextp);
+#endif
+#endif
+
 namespace RDKit {
 namespace StructureCheck {
 
--- ./Code/GraphMol/StructChecker/AtomSymbolMatch.cpp.orig	2018-08-07 23:06:07 +0200
+++ ./Code/GraphMol/StructChecker/AtomSymbolMatch.cpp	2018-08-07 23:09:26 +0200
@@ -224,8 +224,10 @@
    */
   char *context;
 #ifdef WIN32
+#if defined strtok_s
 #define strtok_r strtok_s  // thread safe strtok()
 #endif
+#endif
   const char *atsym = symbol.c_str();
   char pat_buf[512];
   char *tokp;
